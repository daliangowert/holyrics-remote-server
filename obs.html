<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Lower Third - Holyrics</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, Helvetica, sans-serif;
            font-weight: bold;
        }

        .container-text {
            position: absolute;
            bottom: 30px;
            left: 50px;
            opacity: 0; /* Inicia invisível para animação */
        }
        
        .text-span {
            font-size: 50px;
            color: white;
            padding: 10px 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            line-height: 1.3;
            background-size: cover;
            background-position: center;
            border-radius: 8px;
        }

        /* --- TEMAS ESPECÍFICOS --- */
        .theme-song .text-span {
            background-image: url('/assets/music.png');
        }
        .theme-verse .text-span {
            background-image: url('/assets/bible.png');
        }
        .theme-other .text-span {
            background-image: url('/assets/text.png');
        }
        /* --- FIM DOS TEMAS --- */
        
        /* Animações */
        @keyframes slide-down-in {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slide-down-out {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(50px); }
        }

        .visible {
            animation: slide-down-in 0.5s forwards;
        }
        .hidden {
            animation: slide-down-out 0.5s forwards;
        }
    </style>
</head>
<body>
    <div id="container" class="container-text">
        <span id="textSpan" class="text-span"></span>
    </div>

    <script>
        const SERVER_URL = `ws://${window.location.hostname}:8080`;
        const container = document.getElementById('container');
        const textSpan = document.getElementById('textSpan');
        let ws;

        function connect() {
            ws = new WebSocket(SERVER_URL);
            ws.onopen = () => console.log('OBS Conectado ao servidor.');
            ws.onclose = () => setTimeout(connect, 3000);
            ws.onerror = () => ws.close();

            ws.onmessage = (event) => {
                const message = JSON.parse(event.data);

                if (message.type === 'DISPLAY_LOWER_THIRD') {
                    if (message.visible && message.text) {
                        textSpan.innerHTML = message.text.replace(/\n/g, '<br>');
                        container.classList.remove('hidden');
                        container.classList.add('visible');
                    } else {
                        container.classList.remove('visible');
                        container.classList.add('hidden');
                    }
                } 
                else if (message.type === 'PRESENTATION_STATE') {
                    const category = message.data.presentationCategory || 'other';
                    container.className = 'container-text'; // Reseta as classes de tema
                    container.classList.add(`theme-${category}`);
                }
            };
        }

        connect();
    </script>
</body>
</html>